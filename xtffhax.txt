local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local LP = Players.LocalPlayer

-- ===== STATE =====
local State = {
    Name=false, Box=false, Line=false, HP=false, Hitbox=false,
    AimPriority="CrossHair",
    AimWhen="Scope only"
}

-- ===== GUI =====
local gui = Instance.new("ScreenGui", LP.PlayerGui)
gui.Name = "XTFF_UI"
gui.ResetOnSpawn = false

local main = Instance.new("Frame", gui)
main.Size = UDim2.fromOffset(560, 320)
main.Position = UDim2.fromScale(0.5,0.5)
main.AnchorPoint = Vector2.new(0.5,0.5)
main.BackgroundColor3 = Color3.fromRGB(20,20,30)
main.BorderSizePixel = 0

local top = Instance.new("TextLabel", main)
top.Size = UDim2.new(1,0,0,40)
top.BackgroundTransparency = 1
top.Text = "XTFF-Hax"
top.TextColor3 = Color3.new(1,1,1)
top.Font = Enum.Font.GothamBold
top.TextScaled = true

local close = Instance.new("TextButton", main)
close.Size = UDim2.fromOffset(32,32)
close.Position = UDim2.new(1,-36,0,4)
close.Text = "X"
close.Font = Enum.Font.GothamBold
close.TextScaled = true
close.BackgroundTransparency = 1
close.TextColor3 = Color3.new(1,1,1)

-- Left menu
local left = Instance.new("Frame", main)
left.Size = UDim2.fromOffset(150, 250)
left.Position = UDim2.fromOffset(10, 50)
left.BackgroundTransparency = 1

local function MenuBtn(text, y)
    local b = Instance.new("TextButton", left)
    b.Size = UDim2.fromOffset(130, 40)
    b.Position = UDim2.fromOffset(0, y)
    b.Text = text
    b.Font = Enum.Font.GothamBold
    b.TextScaled = true
    b.BackgroundColor3 = Color3.fromRGB(240,240,240)
    b.TextColor3 = Color3.fromRGB(20,20,20)
    b.BorderSizePixel = 0
    return b
end

local btnPlayer = MenuBtn("PLAYER", 0)
local btnAim = MenuBtn("AIM", 50)
local btnSet = MenuBtn("SETTINGS", 100)

local panels = {}

local function NewPanel()
    local p = Instance.new("Frame", main)
    p.Size = UDim2.fromOffset(260, 240)
    p.Position = UDim2.fromOffset(180, 60)
    p.BackgroundTransparency = 1
    p.Visible = false
    return p
end

panels.PLAYER = NewPanel()
panels.AIM = NewPanel()
panels.SET = NewPanel()

local function Show(name)
    for k,v in pairs(panels) do v.Visible = (k==name) end
end

-- PLAYER (ESP toggles)
local y = 0
local function Toggle(parent, text, key)
    local b = Instance.new("TextButton", parent)
    b.Size = UDim2.new(1,0,0,30)
    b.Position = UDim2.fromOffset(0,y)
    y += 36
    b.BackgroundColor3 = Color3.fromRGB(60,60,60)
    b.TextColor3 = Color3.new(1,1,1)
    b.BorderSizePixel = 0
    b.Font = Enum.Font.Gotham
    b.TextSize = 14
    local function refresh()
        b.Text = text..": "..(State[key] and "ON" or "OFF")
    end
    refresh()
    b.MouseButton1Click:Connect(function()
        State[key] = not State[key]
        refresh()
    end)
end

Toggle(panels.PLAYER,"NAME","Name")
Toggle(panels.PLAYER,"BOX","Box")
Toggle(panels.PLAYER,"LINE","Line")
Toggle(panels.PLAYER,"HP","HP")
Toggle(panels.PLAYER,"HITBOX","Hitbox")

-- AIM panel
local function Label(parent, t, y)
    local l = Instance.new("TextLabel", parent)
    l.Size = UDim2.new(1,0,0,24)
    l.Position = UDim2.fromOffset(0,y)
    l.BackgroundTransparency = 1
    l.TextXAlignment = Left
    l.Text = t
    l.TextColor3 = Color3.new(1,1,1)
    l.Font = Enum.Font.Gotham
    l.TextSize = 16
end

local function Radio(parent, t, y, group, value, set)
    local b = Instance.new("TextButton", parent)
    b.Size = UDim2.new(1,0,0,24)
    b.Position = UDim2.fromOffset(0,y)
    b.BackgroundTransparency = 1
    b.TextXAlignment = Left
    b.Font = Enum.Font.Gotham
    b.TextSize = 14
    local function refresh()
        b.Text = (set()==value and "●  " or "○  ")..t
        b.TextColor3 = Color3.new(1,1,1)
    end
    refresh()
    b.MouseButton1Click:Connect(function()
        group(value)
        refresh()
    end)
    return refresh
end

Label(panels.AIM,"Aim priority",0)
local r1 = Radio(panels.AIM,"CrossHair",30,function(v) State.AimPriority=v end,"CrossHair",function() return State.AimPriority end)
local r2 = Radio(panels.AIM,"Distance",55,function(v) State.AimPriority=v end,"Distance",function() return State.AimPriority end)

Label(panels.AIM,"Aim when",95)
local r3 = Radio(panels.AIM,"Scope only",125,function(v) State.AimWhen=v end,"Scope only",function() return State.AimWhen end)
local r4 = Radio(panels.AIM,"Firing only",150,function(v) State.AimWhen=v end,"Firing only",function() return State.AimWhen end)
local r5 = Radio(panels.AIM,"Scope and Firing",175,function(v) State.AimWhen=v end,"Scope and Firing",function() return State.AimWhen end)

-- SETTINGS panel (placeholder)
local info = Instance.new("TextLabel", panels.SET)
info.Size = UDim2.new(1,0,0,60)
info.BackgroundTransparency = 1
info.Text = "Settings panel\n(placeholder)"
info.TextColor3 = Color3.new(1,1,1)
info.Font = Enum.Font.Gotham
info.TextSize = 16

-- Buttons behavior
btnPlayer.MouseButton1Click:Connect(function() Show("PLAYER") end)
btnAim.MouseButton1Click:Connect(function() Show("AIM") end)
btnSet.MouseButton1Click:Connect(function() Show("SET") end)

Show("PLAYER")

close.MouseButton1Click:Connect(function()
    main.Visible = false
end)

UIS.InputBegan:Connect(function(i,g)
    if g then return end
    if i.KeyCode == Enum.KeyCode.RightShift then
        main.Visible = not main.Visible
    end
end)